<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Dexter Attacker ¬∑ Sila Divine ¬∑ Role Hierarchy</title>
    <!-- FONT AWESOME 6 (FREE) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- GOOGLE FONT: INTER & JETBRAINS MONO -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0c0f;
            background-image: radial-gradient(circle at 15% 30%, rgba(255, 70, 70, 0.03) 0%, transparent 25%),
                              radial-gradient(circle at 85% 70%, rgba(255, 200, 50, 0.03) 0%, transparent 30%);
            font-family: 'Inter', sans-serif;
            color: #eef2f5;
            line-height: 1.6;
            padding: 2rem 1.5rem;
            min-height: 100vh;
            transition: 0.2s;
        }

        .container {
            max-width: 1440px;
            margin: 0 auto;
        }

        /* LOGIN SCREEN */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #07090e;
            backdrop-filter: blur(12px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: 0.3s ease;
        }

        .login-card {
            background: linear-gradient(145deg, #141a22, #0d1016);
            border-radius: 40px;
            padding: 2.8rem 2.5rem;
            width: 100%;
            max-width: 460px;
            border: 1px solid #ff5e5e40;
            box-shadow: 0 25px 40px -10px black, 0 0 0 1px rgba(255, 80, 80, 0.2);
            position: relative;
            overflow: hidden;
        }

        .login-wheel {
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 8rem;
            color: #ff3b3b0a;
            transform: rotate(45deg);
        }

        .login-title {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 0.4rem;
            background: linear-gradient(to right, #ffb3b3, #ff6a6a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-sub {
            color: #a0b0c2;
            margin-bottom: 2.2rem;
            font-size: 0.9rem;
            border-left: 4px solid #ff4d4d;
            padding-left: 1rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: #d0dbea;
            margin-bottom: 0.4rem;
            letter-spacing: 1px;
        }

        .login-input {
            width: 100%;
            background: #0b0e12;
            border: 1px solid #313a44;
            border-radius: 16px;
            padding: 1rem 1.3rem;
            font-family: 'Inter', sans-serif;
            color: white;
            outline: none;
            transition: 0.15s;
            font-size: 1rem;
        }

        .login-input:focus {
            border-color: #ff6a6a;
            box-shadow: 0 0 0 3px rgba(255, 80, 80, 0.2);
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(145deg, #ff5e4a, #ff3838);
            border: none;
            border-radius: 50px;
            padding: 1.1rem;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.1s;
            border-bottom: 5px solid #a12323;
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.7rem;
        }

        .login-btn:active {
            border-bottom-width: 2px;
            transform: translateY(3px);
        }

        .register-link {
            margin-top: 1.8rem;
            text-align: center;
            color: #a7b5c5;
            font-size: 0.9rem;
        }

        .register-link span {
            color: #ff9f7e;
            font-weight: 700;
            cursor: pointer;
            border-bottom: 1px solid #ff7e7e;
        }

        /* MAIN APP (HIDDEN AWAL) */
        .main-app {
            display: none;
        }

        /* HEADER DIVINE */
        .divine-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
            flex-wrap: wrap;
            gap: 1.5rem;
            border-bottom: 1px solid rgba(255, 60, 60, 0.2);
            padding-bottom: 1.5rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .wheel-icon {
            font-size: 2.2rem;
            color: #ff4d4d;
            animation: spinSlow 8s infinite linear;
            filter: drop-shadow(0 0 8px rgba(255, 70, 70, 0.6));
        }

        @keyframes spinSlow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .title {
            font-size: 1.9rem;
            font-weight: 800;
            letter-spacing: -0.02em;
        }

        .title span {
            background: linear-gradient(145deg, #ff6a6a, #ff3838);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-left: 0.2rem;
        }

        .badge-creator {
            background: rgba(255, 70, 70, 0.1);
            backdrop-filter: blur(4px);
            padding: 0.5rem 1.2rem;
            border-radius: 40px;
            border: 1px solid rgba(255, 100, 100, 0.3);
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        /* ROLE BADGE */
        .role-badge {
            background: #1e1a24;
            padding: 0.4rem 1.2rem;
            border-radius: 30px;
            border: 1px solid #ffb86b;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-weight: 600;
        }

        /* WHEEL PANEL */
        .wheel-panel {
            background: rgba(12, 15, 20, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #2a2e34;
            border-radius: 28px;
            padding: 1.2rem 2rem;
            margin-bottom: 2.5rem;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 15px 30px -10px rgba(0,0,0,0.7);
            border-left: 6px solid #ff4d4d;
        }

        .rotation-box {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .adapt-level {
            background: #1e1e2a;
            padding: 0.5rem 1.1rem;
            border-radius: 30px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            border: 1px solid #ff4d4d;
        }

        /* USER MANAGEMENT SECTION (khusus owner/partner) */
        .user-mgmt-section {
            background: #0e1217;
            border-radius: 26px;
            padding: 1.8rem;
            margin-bottom: 2rem;
            border: 1px solid #3a3245;
            border-left: 6px solid #ffaa5e;
        }

        .mgmt-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1.5rem;
        }

        .user-list {
            background: #0b0e14;
            border-radius: 20px;
            padding: 1.3rem;
            border: 1px solid #353f4a;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.7rem 0;
            border-bottom: 1px solid #20262e;
        }

        .user-role-tag {
            font-size: 0.7rem;
            padding: 0.2rem 0.8rem;
            border-radius: 30px;
            background: #2a2a36;
        }

        .role-owner { background: #b32b2b; color: white; }
        .role-partner { background: #b38f2b; color: black; }
        .role-vip { background: #2b6bb3; color: white; }
        .role-member { background: #3a4052; color: white; }

        .create-user-form {
            background: #0b0e14;
            border-radius: 20px;
            padding: 1.5rem;
        }

        /* ATTACK GRID, AI SECTION, TERMINAL (sama seperti sebelumnya, dipendekkan utk space) */
        .grid-2col {
            display: grid;
            grid-template-columns: 2.2fr 1.3fr;
            gap: 1.8rem;
            margin-bottom: 2rem;
        }

        .attack-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.3rem;
        }

        .attack-card {
            background: linear-gradient(145deg, #12161c, #0c0f14);
            border-radius: 20px;
            padding: 1.5rem 1.2rem;
            border: 1px solid #272c33;
            transition: 0.2s;
            box-shadow: 0 8px 0 #080a0c;
            cursor: pointer;
        }

        .attack-card:hover {
            border-color: #ff5e5e;
            transform: translateY(-4px);
            box-shadow: 0 12px 0 #080a0c, 0 0 15px rgba(255, 80, 80, 0.3);
        }

        .ai-section {
            background: radial-gradient(circle at 20% 30%, #1a141e, #0d0f13);
            border-radius: 28px;
            padding: 1.8rem;
            border: 1px solid #3d3345;
        }

        .ai-name {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(to right, #ffd9b5, #ffa07a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .terminal {
            background: #080b0e;
            border-radius: 18px;
            padding: 1.4rem;
            font-family: 'JetBrains Mono', monospace;
            border: 1px solid #2e353d;
            margin-top: 2.2rem;
            border-left: 6px solid #ff4d4d;
        }

        .footer-note {
            margin-top: 2.5rem;
            text-align: center;
            color: #7a8793;
            font-size: 0.8rem;
            border-top: 1px solid #252c33;
            padding-top: 1.8rem;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<!-- =============== LOGIN SCREEN =============== -->
<div id="loginScreen" class="login-screen">
    <div class="login-card">
        <i class="fas fa-sync-alt login-wheel"></i>
        <div class="login-title">ATTACKER‚∏∏DEXTER</div>
        <div class="login-sub">Sila Divine ¬∑ Wheel Authentication</div>
        
        <!-- LOGIN FORM -->
        <div class="input-group">
            <label class="input-label"><i class="fas fa-user"></i> USERNAME</label>
            <input type="text" id="loginUsername" class="login-input" placeholder="masukkan username" autocomplete="off">
        </div>
        <div class="input-group">
            <label class="input-label"><i class="fas fa-lock"></i> PASSWORD</label>
            <input type="password" id="loginPassword" class="login-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <button id="loginBtn" class="login-btn"><i class="fas fa-sign-in-alt"></i> PUTAR WHEEL ¬∑ LOGIN</button>
        
        <div class="register-link">
            <span id="showRegisterBtn">‚∏ª BUAT AKUN BARU ‚∏ª</span> (owner/partner only)
        </div>
    </div>
</div>

<!-- =============== REGISTER MODAL (SIMPLE) =============== -->
<div id="registerModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:10000; justify-content:center; align-items:center;" onclick="if(event.target===this) this.style.display='none'">
    <div style="background:#141a22; max-width:400px; margin:auto; padding:2rem; border-radius:30px; border:1px solid #ff7e7e;">
        <h3 style="margin-bottom:1.5rem; color:#ffb5b5;"><i class="fas fa-user-plus"></i> CREATE USER ¬∑ HIERARCHY</h3>
        <div class="input-group">
            <label class="input-label">ROLE YANG BUAT (OTOMATIS)</label>
            <input type="text" id="creatorRoleDisp" class="login-input" value="-" disabled style="background:#1f262e;">
        </div>
        <div class="input-group">
            <label class="input-label">USERNAME BARU</label>
            <input type="text" id="newUsername" class="login-input" placeholder="username">
        </div>
        <div class="input-group">
            <label class="input-label">PASSWORD</label>
            <input type="password" id="newPassword" class="login-input" placeholder="password">
        </div>
        <div class="input-group">
            <label class="input-label">PILIH ROLE</label>
            <select id="newRoleSelect" class="login-input" style="color:white;">
                <option value="partner">PARTNER</option>
                <option value="vip">VIP</option>
                <option value="member">MEMBER</option>
            </select>
            <p style="color:#b0b9c5; font-size:0.7rem; margin-top:0.3rem;">owner bisa bikin partner,vip,member | partner bikin vip,member | vip bikin member</p>
        </div>
        <button id="confirmCreateUserBtn" class="login-btn" style="background:#4a2e6b; border-bottom-color:#2e1d41;">CREATE</button>
        <p style="margin-top:1rem; text-align:center; color:#aaa;"><span onclick="document.getElementById('registerModal').style.display='none'" style="cursor:pointer; border-bottom:1px solid red;">tutup</span></p>
    </div>
</div>

<!-- =============== MAIN APPLICATION (HIDDEN SAMPAI LOGIN) =============== -->
<div id="mainApp" class="main-app container">
    <!-- HEADER -->
    <div class="divine-header">
        <div class="logo">
            <i class="fas fa-sync-alt wheel-icon"></i>
            <div class="title">attacker<span>‚∏∏DEXTER</span></div>
        </div>
        <div style="display:flex; gap:1rem; align-items:center;">
            <div class="role-badge" id="roleBadgeHeader">
                <i class="fas fa-shield-alt"></i> <span id="currentRoleDisplay">MEMBER</span>
            </div>
            <div class="badge-creator">
                <i class="fas fa-user-circle"></i> <span id="currentUserDisplay">-</span>
                <i class="fas fa-sign-out-alt" id="logoutBtn" style="margin-left:0.8rem; cursor:pointer; color:#ffa5a5;"></i>
            </div>
        </div>
    </div>

    <!-- WHEEL STATUS -->
    <div class="wheel-panel">
        <div class="rotation-box">
            <i class="fas fa-compact-disc rotation-icon" style="color:#ff6060;"></i>
            <span class="adapt-text">WHEEL ¬∑ ADAPTASI LEVEL 02</span>
            <span class="adapt-level"><i class="fas fa-rotate"></i> 2/‚àû</span>
        </div>
        <div>
            <span id="userCountDisplay"><i class="fas fa-users"></i> total user: 4</span>
        </div>
    </div>

    <!-- ===== USER MANAGEMENT SECTION ===== (HANYA UNTUK OWNER, PARTNER, VIP) -->
    <div id="userMgmtSection" class="user-mgmt-section">
        <div style="display:flex; align-items:center; gap:0.7rem; margin-bottom:0.5rem;">
            <i class="fas fa-user-cog" style="color:#ffae70;"></i>
            <h3 style="font-weight:600;">üë• USER HIERARCHY ¬∑ CREATE USER</h3>
            <span id="creatorHint" style="background:#2f3540; padding:0.2rem 1rem; border-radius:30px; font-size:0.7rem;"></span>
        </div>
        <div class="mgmt-grid">
            <!-- DAFTAR USER -->
            <div class="user-list">
                <h4 style="margin-bottom:1rem;"><i class="fas fa-list"></i> REGISTERED USERS</h4>
                <div id="userListContainer">
                    <!-- JS akan generate -->
                </div>
            </div>
            <!-- FORM CREATE USER (dinamis) -->
            <div class="create-user-form">
                <h4 style="margin-bottom:1.2rem;"><i class="fas fa-user-plus"></i> CREATE NEW ACCOUNT</h4>
                <div class="input-group">
                    <label class="input-label">USERNAME</label>
                    <input type="text" id="createUsername" class="login-input" placeholder="new username">
                </div>
                <div class="input-group">
                    <label class="input-label">PASSWORD</label>
                    <input type="password" id="createPassword" class="login-input" placeholder="password">
                </div>
                <div class="input-group">
                    <label class="input-label">ROLE</label>
                    <select id="createRoleSelect" class="login-input" style="color:white;">
                        <option value="vip">VIP</option>
                        <option value="member">MEMBER</option>
                    </select>
                    <p id="roleRestrictionNote" style="color:#ffae70; font-size:0.7rem;"></p>
                </div>
                <button id="createUserBtn" class="login-btn" style="background:#5a3c3c; border-bottom-color:#3d2626; margin-top:0.5rem;"><i class="fas fa-plus-circle"></i> CREATE USER</button>
            </div>
        </div>
    </div>

    <!-- ATTACK GRID + AI SECTION -->
    <div class="grid-2col">
        <!-- ATTACK CARDS -->
        <div>
            <h3 style="margin-bottom:1.2rem;"><i class="fas fa-bullseye" style="color:#ff7070;"></i> ATTACK VECTOR</h3>
            <div class="attack-grid">
                <div class="attack-card" onclick="event.preventDefault(); attackAction('DDOS LAUNCHED ¬∑ L4/L7 flood', this); return false;">
                    <i class="fas fa-network-wired attack-icon"></i>
                    <div class="attack-title">DDOS</div>
                    <div class="attack-desc">Volumetric flood, SYN/ACK</div>
                </div>
                <div class="attack-card" onclick="event.preventDefault(); attackAction('OTP SPAM WA ¬∑ 100+ request', this); return false;">
                    <i class="fas fa-message attack-icon"></i>
                    <div class="attack-title">SPAM OTP WA</div>
                    <div class="attack-desc">BOMB SMS/WA</div>
                </div>
                <div class="attack-card" onclick="event.preventDefault(); attackAction('EMAIL BOMBER ¬∑ 500 email', this); return false;">
                    <i class="fas fa-envelope attack-icon"></i>
                    <div class="attack-title">EMAIL BOMB</div>
                </div>
                <div class="attack-card" onclick="event.preventDefault(); attackAction('SQL INJECTION ¬∑ OR 1=1', this); return false;">
                    <i class="fas fa-database attack-icon"></i>
                    <div class="attack-title">SQL INJECT</div>
                </div>
            </div>
        </div>
        <!-- DEXTER AI -->
        <div class="ai-section">
            <div style="display:flex; align-items:center; gap:0.8rem;">
                <i class="fas fa-microchip" style="font-size:2rem; color:#ffaa70;"></i>
                <span class="ai-name">DEXTER ai</span>
            </div>
            <div style="margin-top:1.2rem; background:#0e1116; border-radius:18px; padding:1rem;">
                <p><i class="fas fa-robot" style="color:#ffae70;"></i> <span style="color:#ffc49b;">Dexter ai:</span> Wheel berputar. Siap eksekusi perintah, <span id="aiUserNameRef">Master</span>.</p>
            </div>
            <div style="margin-top:1rem; display:flex; gap:0.5rem;">
                <input type="text" id="aiCommand" class="login-input" style="background:#0a0c10;" placeholder="perintah ke Dexter ai...">
                <button onclick="event.preventDefault(); attackAction('üß† DEXTER ai: ' + document.getElementById('aiCommand').value, this); return false;" style="background:#ff5e4a; border:none; border-radius:50px; padding:0 1.5rem; color:white; font-weight:700;">KIRIM</button>
            </div>
        </div>
    </div>

    <!-- TERMINAL OUTPUT -->
    <div class="terminal" id="outputTerminal">
        <div style="display:flex; gap:0.5rem; align-items:center; color:#b1c3d6; margin-bottom:1rem;">
            <i class="fas fa-terminal"></i> <span style="font-weight:700;">ATTACK LOG ¬∑ WHEEL SYNC</span>
        </div>
        <div id="terminalBody" style="color:#cbd5e6; font-family: 'JetBrains Mono', monospace; font-size:0.9rem;">
            [‚∏∏] Mahoraga aktif. Sila divine online.<br>
            [‚∏∏] Role: <span id="terminalRole">-</span> ¬∑ User: <span id="terminalUser">-</span>
        </div>
    </div>

    <div class="footer-note">
        <i class="fas fa-sync-alt" style="color:#ff6666;"></i> Cursed Mahoraga ¬∑ adaptation system ¬∑ created by DEXTER ‚∏∑ SILA DIVINE ‚∏∏
    </div>
</div>

<script>
    // ==============================================
    // CURSED MAHORAGA - ROLE HIERARCHY SYSTEM
    // OWNER (Dexter) ‚Üí PARTNER ‚Üí VIP ‚Üí MEMBER
    // HIERARCHI PEMBUATAN AKUN: 
    // Owner: bisa bikin partner, vip, member
    // Partner: bisa bikin vip, member
    // VIP: bisa bikin member
    // MEMBER: TIDAK BISA BIKIN AKUN SAMA SEKALI
    // ==============================================

    // ---- GLOBAL STORAGE (user DB) ----
    let users = [
        { username: 'dexter', password: 'dexter123', role: 'owner' },  // OWNER ABSOLUTE
        { username: 'partner1', password: 'partner123', role: 'partner' },
        { username: 'vip1', password: 'vip123', role: 'vip' },
        { username: 'member1', password: 'member123', role: 'member' }
    ];

    let currentUser = null; // { username, role }

    // ---- HELPER FUNCTIONS ----
    function saveToLocal() {
        localStorage.setItem('mahoragaUsers', JSON.stringify(users));
    }

    function loadFromLocal() {
        const stored = localStorage.getItem('mahoragaUsers');
        if (stored) {
            try { users = JSON.parse(stored); } catch(e) {}
        } else {
            // default users
            users = [
                { username: 'dexter', password: 'dexter123', role: 'owner' },
                { username: 'partner1', password: 'partner123', role: 'partner' },
                { username: 'vip1', password: 'vip123', role: 'vip' },
                { username: 'member1', password: 'member123', role: 'member' }
            ];
            saveToLocal();
        }
    }

    // ---- INIT LOAD ----
    loadFromLocal();

    // ---- LOGIN HANDLER ----
    document.getElementById('loginBtn').addEventListener('click', function(e) {
        e.preventDefault();
        const uname = document.getElementById('loginUsername').value.trim().toLowerCase();
        const pwd = document.getElementById('loginPassword').value.trim();

        const foundUser = users.find(u => u.username.toLowerCase() === uname && u.password === pwd);
        if (foundUser) {
            currentUser = { username: foundUser.username, role: foundUser.role };
            // update UI
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // update all user display
            document.getElementById('currentUserDisplay').innerText = foundUser.username;
            document.getElementById('currentRoleDisplay').innerText = foundUser.role.toUpperCase();
            document.getElementById('terminalRole').innerText = foundUser.role.toUpperCase();
            document.getElementById('terminalUser').innerText = foundUser.username;
            document.getElementById('aiUserNameRef').innerText = foundUser.username;
            
            // Siapkan user management sesuai role
            renderUserList();
            adjustUIBasedOnRole();
        } else {
            alert('‚ùå Wheel tidak berputar. Username/password salah.');
        }
    });

    // ---- LOGOUT ----
    document.getElementById('logoutBtn').addEventListener('click', function(e) {
        currentUser = null;
        document.getElementById('mainApp').style.display = 'none';
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('loginUsername').value = '';
        document.getElementById('loginPassword').value = '';
    });

    // ---- REGISTER MODAL (SHOW) ----
    document.getElementById('showRegisterBtn').addEventListener('click', function() {
        if (!currentUser) {
            alert('Lu harus login dulu.');
            return;
        }
        // cek role
        if (currentUser.role === 'member') {
            alert('‚ùå MEMBER TIDAK BISA MEMBUAT AKUN.');
            return;
        }
        document.getElementById('creatorRoleDisp').value = currentUser.role.toUpperCase();
        // set select option berdasarkan role
        const select = document.getElementById('newRoleSelect');
        select.innerHTML = '';
        if (currentUser.role === 'owner') {
            select.innerHTML += '<option value="partner">PARTNER</option>';
            select.innerHTML += '<option value="vip">VIP</option>';
            select.innerHTML += '<option value="member">MEMBER</option>';
        } else if (currentUser.role === 'partner') {
            select.innerHTML += '<option value="vip">VIP</option>';
            select.innerHTML += '<option value="member">MEMBER</option>';
        } else if (currentUser.role === 'vip') {
            select.innerHTML += '<option value="member">MEMBER</option>';
        }
        document.getElementById('registerModal').style.display = 'flex';
    });

    // ---- CONFIRM CREATE USER (from modal) ----
    document.getElementById('confirmCreateUserBtn').addEventListener('click', function() {
        const newUname = document.getElementById('newUsername').value.trim();
        const newPass = document.getElementById('newPassword').value.trim();
        const newRole = document.getElementById('newRoleSelect').value;

        if (!newUname || !newPass) return alert('Username/password wajib.');
        
        // cek duplikat
        if (users.find(u => u.username.toLowerCase() === newUname.toLowerCase())) {
            return alert('Username sudah ada.');
        }

        // Validasi hak buat (owner, partner, vip)
        if (!currentUser) return alert('login dulu');
        if (currentUser.role === 'member') return alert('member tidak boleh create user');

        // Tambah user
        users.push({ username: newUname, password: newPass, role: newRole });
        saveToLocal();
        alert(`‚úÖ User ${newUname} (${newRole}) berhasil dibuat.`);
        document.getElementById('registerModal').style.display = 'none';
        document.getElementById('newUsername').value = '';
        document.getElementById('newPassword').value = '';
        if (currentUser) renderUserList();
    });

    // ---- RENDER USER LIST (di management) ----
    function renderUserList() {
        const container = document.getElementById('userListContainer');
        if (!container) return;
        let html = '';
        users.forEach(u => {
            let roleClass = 'user-role-tag ';
            if (u.role === 'owner') roleClass += 'role-owner';
            else if (u.role === 'partner') roleClass += 'role-partner';
            else if (u.role === 'vip') roleClass += 'role-vip';
            else roleClass += 'role-member';
            
            html += `<div class="user-item">
                        <span><i class="fas fa-user"></i> ${u.username}</span>
                        <span class="${roleClass}">${u.role.toUpperCase()}</span>
                      </div>`;
        });
        container.innerHTML = html;
        document.getElementById('userCountDisplay').innerHTML = `<i class="fas fa-users"></i> total user: ${users.length}`;
    }

    // ---- ADJUST UI BERDASARKAN ROLE (yabisa bikin user di panel) ----
    function adjustUIBasedOnRole() {
        const mgmtSection = document.getElementById('userMgmtSection');
        const createRoleSelect = document.getElementById('createRoleSelect');
        const roleNote = document.getElementById('roleRestrictionNote');
        
        if (!currentUser) return;
        
        // Tampilkan/sembunyikan user management
        if (currentUser.role === 'owner' || currentUser.role === 'partner' || currentUser.role === 'vip') {
            mgmtSection.style.display = 'block';
            document.getElementById('creatorHint').innerHTML = `üîë CREATE AS: ${currentUser.role.toUpperCase()}`;
            
            // Atur opsi create role
            createRoleSelect.innerHTML = '';
            if (currentUser.role === 'owner') {
                createRoleSelect.innerHTML += '<option value="partner">PARTNER</option>';
                createRoleSelect.innerHTML += '<option value="vip">VIP</option>';
                createRoleSelect.innerHTML += '<option value="member">MEMBER</option>';
                roleNote.innerText = 'Owner: bisa bikin partner, vip, member.';
            } else if (currentUser.role === 'partner') {
                createRoleSelect.innerHTML += '<option value="vip">VIP</option>';
                createRoleSelect.innerHTML += '<option value="member">MEMBER</option>';
                roleNote.innerText = 'Partner: bisa bikin vip & member.';
            } else if (currentUser.role === 'vip') {
                createRoleSelect.innerHTML += '<option value="member">MEMBER</option>';
                roleNote.innerText = 'VIP: hanya bisa bikin member.';
            }
        } else {
            mgmtSection.style.display = 'none'; // MEMBER ga liat menu user management
        }
        renderUserList();
    }

    // ---- CREATE USER VIA PANEL (button di management) ----
    document.getElementById('createUserBtn')?.addEventListener('click', function(e) {
        e.preventDefault();
        if (!currentUser || currentUser.role === 'member') {
            return alert('‚ùå Tidak punya izin create user.');
        }
        const uname = document.getElementById('createUsername').value.trim();
        const pass = document.getElementById('createPassword').value.trim();
        const role = document.getElementById('createRoleSelect').value;

        if (!uname || !pass) return alert('Isi username & password.');
        if (users.find(u => u.username.toLowerCase() === uname.toLowerCase())) {
            return alert('Username sudah terdaftar.');
        }

        // Validasi tambahan sesuai hierarki (jaga2)
        if (currentUser.role === 'partner' && (role !== 'vip' && role !== 'member')) {
            return alert('Partner hanya bisa bikin VIP atau MEMBER');
        }
        if (currentUser.role === 'vip' && role !== 'member') {
            return alert('VIP hanya bisa bikin MEMBER');
        }

        users.push({ username: uname, password: pass, role: role });
        saveToLocal();
        alert(`‚úÖ User ${uname} (${role}) dibuat.`);
        document.getElementById('createUsername').value = '';
        document.getElementById('createPassword').value = '';
        renderUserList();
    });

    // ---- ATTACK ACTION - ANTI REFRESH ----
    window.attackAction = function(msg, el) {
        if (!currentUser) return alert('Login dulu.');
        const terminalBody = document.getElementById('terminalBody');
        const timestamp = new Date().toLocaleTimeString('en-US', { hour12: false });
        terminalBody.innerHTML = `[${timestamp}] [‚∏∏] ADAPTASI ¬∑ wheel berputar<br>[‚∏∏] ${msg}<br>[‚∏∏] Role: ${currentUser.role.toUpperCase()} ¬∑ User: ${currentUser.username}`;
        
        // animasi wheel (opsional)
        const wheel = document.querySelector('.adapt-level i');
        if (wheel) {
            // gak refresh
        }
        return false;
    };

    // ---- HENTIKAN REFRESH SEMUA onclick tombol attack ----
    // gunakan event delegation / prevent default sudah ada di onclick.
    // plus untuk ai send button

    // ---- INIT SESSION jika sudah login sebelumnya? (opsional) ----
    window.onload = function() {
        // Tampilkan login
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    };

</script>

<!-- Font Awesome (redundan aman) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</body>
</html>
