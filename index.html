<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zyxxennn Attacker</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.2/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .marquee { overflow:hidden; white-space:nowrap; box-sizing: border-box; animation: marquee 12s linear infinite; }
    @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
  </style>
</head>
<body class="bg-zinc-900 text-zinc-100 min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-xl bg-zinc-800 rounded-2xl shadow-lg overflow-hidden">
    <div class="bg-black/60 px-4 py-2">
      <div class="marquee text-2xl font-extrabold tracking-wide text-amber-400">Zyxxennn Attacker</div>
    </div>

    <div class="p-6">
      <div class="flex flex-col items-center">
        <img id="logoImg" src="https://files.catbox.moe/91r278.jpg" alt="Logo" class="w-40 h-40 rounded-xl object-cover border-2 border-amber-500 shadow-md">
        <h2 id="welcomeText" class="mt-4 text-xl text-center">WELCOME</h2>
      </div>

      <div class="mt-6 space-y-3">
        <label class="block text-sm text-zinc-300">Nomor WhatsApp tujuan (contoh: 6281234567890)</label>
        <input id="targetNumber" class="w-full p-3 rounded bg-zinc-700 text-white" placeholder="Masukkan nomor tujuan..." />
      </div>

      <div class="mt-6">
        <div class="text-sm text-zinc-300 mb-2">Pilih fitur</div>
        <div class="grid grid-cols-2 gap-3">
          <button id="btnCrashAndroid" class="py-3 rounded bg-red-600 hover:bg-red-700">CRASH ANDROID</button>
          <button id="btnCrashIphone" class="py-3 rounded bg-sky-600 hover:bg-sky-700">CRASH IPHONE</button>
        </div>
      </div>

      <div class="mt-6 flex justify-between items-center">
        <div class="space-x-2">
          <a id="ownerLink" href="https://t.me/username_owner" target="_blank" class="inline-block px-4 py-2 bg-amber-500 text-black rounded font-semibold">Owner</a>
          <a id="channelLink" href="https://t.me/channel_anda" target="_blank" class="inline-block px-4 py-2 bg-indigo-600 text-white rounded font-semibold">Channel</a>
        </div>

        <div>
          <button id="logoutBtn" class="px-4 py-2 rounded bg-zinc-700 hover:bg-zinc-600">Logout</button>
        </div>
      </div>

      <div class="mt-6 text-sm text-zinc-300">Masa aktif key: <span id="keyExpiry">— belum login —</span></div>
      <div id="notice" class="mt-4 text-sm text-amber-300"></div>
    </div>
  </div>

  <script>
    let session = { userId: null, nama: null, expires: null, keyValue: null };
    const welcomeText = document.getElementById('welcomeText');
    const keyExpiryEl = document.getElementById('keyExpiry');
    const notice = document.getElementById('notice');

    (function init() {
      const s = localStorage.getItem('zyx_session');
      if (s) {
        try { session = JSON.parse(s); applySession(); } catch {}
      }
    })();

    function applySession() {
      welcomeText.innerText = session.nama ? `WELCOME "${session.nama}"` : 'WELCOME';
      keyExpiryEl.innerText = session.expires ? new Date(session.expires).toLocaleString() : '— belum login —';
    }

    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('zyx_session');
      session = { userId: null, nama: null, expires: null, keyValue: null };
      applySession();
      notice.innerText = 'Kamu telah logout.';
    });

    async function promptLogin() {
      const key = prompt('Masukkan key yang kamu dapat dari bot (/ckey):');
      if (!key) return false;
      try {
        const res = await fetch('/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ key })
        });
        const data = await res.json();
        if (data.success) {
          session.userId = data.userId || null;
          session.nama = data.nama || null;
          session.keyValue = key;
          session.expires = data.expires || null;
          localStorage.setItem('zyx_session', JSON.stringify(session));
          applySession();
          notice.innerText = 'Login sukses.';
          return true;
        } else {
          alert(data.msg || 'Key tidak valid');
          return false;
        }
      } catch (err) {
        alert('Gagal login: ' + err.message);
        return false;
      }
    }

    async function sendViaFeature(feature) {
      if (!session.userId) {
        const ok = await promptLogin();
        if (!ok) return;
      }

      const target = document.getElementById('targetNumber').value.trim();
      if (!target) return alert('Masukkan nomor tujuan.');

      notice.innerText = 'Mengirim permintaan...';

      try {
        const res = await fetch('/whatsapp/send', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            senderNumber: null, // backend bisa pakai sender default
            targetNumber: target,
            feature: feature,
            userId: session.userId
          })
        });
        const data = await res.json();
        if (data.success) {
          alert(data.msg); // popup sukses persis
          notice.innerText = 'Permintaan berhasil dikirim.';
        } else {
          notice.innerText = `❌ Gagal: ${data.msg || 'unknown'}`;
        }
      } catch (err) {
        notice.innerText = '❌ Error: ' + err.message;
      }
    }

    document.getElementById('btnCrashAndroid').addEventListener('click', () => sendViaFeature('CRASH_ANDROID'));
    document.getElementById('btnCrashIphone').addEventListener('click', () => sendViaFeature('CRASH_IPHONE'));

    // Update owner/channel links placeholders
    document.getElementById('ownerLink').href = 'https://t.me/username_owner';
    document.getElementById('channelLink').href = 'https://t.me/channel_anda';
  </script>
</body>
</html>
